FROM node:22.15.1-alpine3.21

WORKDIR /app

ARG VITE_SENTRY_DSN
ARG SENTRY_AUTH_TOKEN
ARG VITE_APP_ENV
ARG VITE_COMMIT_SHA

ENV VITE_SENTRY_DSN=$VITE_SENTRY_DSN
ENV SENTRY_AUTH_TOKEN=$SENTRY_AUTH_TOKEN
ENV VITE_APP_ENV=$VITE_APP_ENV
ENV VITE_COMMIT_SHA=$VITE_COMMIT_SHA

COPY package*.json ./
RUN npm install

COPY . .
RUN npm run build
RUN npm run build-storybook